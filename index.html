<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Signage Display</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body, html { 
            margin: 0; padding: 0; 
            width: 100%; height: 100%; 
            overflow: hidden; 
            background: #000; 
            font-family: 'Chakra Petch', sans-serif;
        }
        
        /* Overlay "Click to Start" */
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 9999;
            color: white;
            transition: opacity 0.5s;
        }
        .start-btn {
            padding: 20px 40px;
            font-size: 30px;
            font-family: 'Chakra Petch', sans-serif;
            font-weight: bold;
            background: #FF0080;
            border: none; color: white;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.05);} 100% {transform: scale(1);} }

        /* Grid Layout */
        #grid-container {
            display: grid;
            width: 1920px; height: 1080px;
            grid-template-rows: 960px 120px;
            grid-template-columns: 640px 1280px;
        }
        #zone-web { grid-row: 1; grid-column: 1; background: #fff; border-right: 4px solid #001a4d; }
        
        #right-column { grid-row: 1; grid-column: 2; display: flex; flex-direction: column; background: #000; }
        
        #dept-header {
            height: 240px; background-color: #001a4d; color: #ffffff;
            display: flex; justify-content: center; align-items: center; text-align: center;
            font-size: 60px; font-weight: 700; text-transform: uppercase;
            line-height: 1.2; padding: 0 20px; z-index: 5; overflow: hidden;
        }
        #video-container { flex-grow: 1; position: relative; background: #000; }

        #zone-marquee {
            grid-row: 2; grid-column: 1 / span 2;
            background: linear-gradient(90deg, #FF0080, #7928CA, #FF0080);
            background-size: 200% 200%;
            display: flex; align-items: center; overflow: hidden; white-space: nowrap;
            color: white; font-size: 55px; font-weight: 600;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
            animation: gradientMove 5s ease infinite; z-index: 10;
        }

        iframe { width: 100%; height: 100%; border: none; }
        
        @keyframes gradientMove { 
            0% {background-position: 0% 50%} 50% {background-position: 100% 50%} 100% {background-position: 0% 50%} 
        }
        .scrolling-text { display: inline-block; padding-left: 100%; }
        @keyframes scroll-left { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
    </style>
</head>
<body>

    <div id="start-overlay">
        <h1 class="mb-4">Digital Signage System</h1>
        <button class="start-btn" onclick="startSystem()">คลิกเพื่อเริ่มระบบ Fullscreen</button>
    </div>

    <div id="grid-container">
        <div id="zone-web"><iframe id="frame-web" src=""></iframe></div>
        <div id="right-column">
            <div id="dept-header">Digital Signage System</div>
            <div id="video-container"></div>
        </div>
        <div id="zone-marquee"><div class="scrolling-text" id="marquee-text">รอรับสัญญาณ...</div></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // ฟังก์ชันเข้าสู่โหมด Fullscreen
        function startSystem() {
            const elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.webkitRequestFullscreen) { /* Safari */
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) { /* IE11 */
                elem.msRequestFullscreen();
            }
            // ซ่อน Overlay
            document.getElementById('start-overlay').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('start-overlay').style.display = 'none';
            }, 500);
        }

        // --- Firebase Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyDGYuI3yxJbUTc6T_0pm6WiEKZul11tXS0",
            authDomain: "suchartwork-1487382986748.firebaseapp.com",
            databaseURL: "https://suchartwork-1487382986748.firebaseio.com",
            projectId: "suchartwork-1487382986748",
            storageBucket: "suchartwork-1487382986748.firebasestorage.app",
            messagingSenderId: "353884592527",
            appId: "1:353884592527:web:c201a092042a005feb13fa"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const frameWeb = document.getElementById('frame-web');
        const divVideo = document.getElementById('video-container');
        const marqueeText = document.getElementById('marquee-text');
        const deptHeader = document.getElementById('dept-header');

        let currentWebUrl = "";
        let currentYoutubeId = "";

        db.ref('signage_data').on('value', (snapshot) => {
            const data = snapshot.val();
            if(!data) return;

            if(data.deptName) deptHeader.innerText = data.deptName;

            if (marqueeText.innerText !== data.text || marqueeText.dataset.speed != data.speed) {
                marqueeText.innerText = data.text || "";
                marqueeText.dataset.speed = data.speed;
                marqueeText.style.animation = 'none';
                marqueeText.offsetHeight; 
                const speed = data.speed || 30;
                marqueeText.style.animation = `scroll-left ${speed}s linear infinite`;
            }

            if (data.webUrl && data.webUrl !== currentWebUrl) {
                currentWebUrl = data.webUrl;
                frameWeb.src = currentWebUrl;
            }

            if (data.youtubeId && data.youtubeId !== currentYoutubeId) {
                currentYoutubeId = data.youtubeId;
                let embedUrl = "";
                if (currentYoutubeId.startsWith("PL")) {
                    embedUrl = `https://www.youtube.com/embed?listType=playlist&list=${currentYoutubeId}&autoplay=1&mute=1&loop=1&controls=0`;
                } else {
                    embedUrl = `https://www.youtube.com/embed/${currentYoutubeId}?playlist=${currentYoutubeId}&autoplay=1&mute=1&loop=1&controls=0`;
                }
                divVideo.innerHTML = `<iframe src="${embedUrl}" allow="autoplay; encrypted-media"></iframe>`;
            }
        });
    </script>
</body>
</html>
